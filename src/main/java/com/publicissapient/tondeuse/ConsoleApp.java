/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.publicissapient.tondeuse;

import com.publicissapient.tondeuse.domain.PositionProvider;
import com.publicissapient.tondeuse.domain.configuration.Configuration;
import com.publicissapient.tondeuse.domain.configuration.errors.ConfigurationException;
import com.publicissapient.tondeuse.domain.configuration.errors.InvalidMoveEventArg;
import com.publicissapient.tondeuse.domain.configuration.providers.FileConfigurationProvider;
import com.publicissapient.tondeuse.service.MownerController;
import lombok.extern.slf4j.Slf4j;

@Slf4j
public class ConsoleApp {

    private static final String FILE_CONF = "file.txt";

    private void run()  throws ConfigurationException {

        log.info("[ConsoleApp] Starting mowner controller...");
        new MownerController()
                .load(Configuration.basedOn(FileConfigurationProvider.fromRessource(FILE_CONF)))
                .withAlerter(ConsoleApp::notifyInvalidMove)
                .withResultPublisher(ConsoleApp::PrintMownerFinalLocation)
                .Run();
    }

    public static void main(String[] args) throws ConfigurationException {
        new ConsoleApp().run();
    }

    private static void notifyInvalidMove(InvalidMoveEventArg x) {
        log.info("[Mowner " + x.getMownerID().toString() + "] tried to reach invalid position at : " + x.getTargetPosition().toString());
    }

    private static void PrintMownerFinalLocation(PositionProvider x) {
        log.info("[Mowner " + x.getID().toString() + "] Job complete : position is " + x.getCurrentLocation().toString());
    }

}
